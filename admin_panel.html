<!DOCTYPE html>
<html>
<head>
  <title>Admin Panel</title>
  <link rel="icon" type="images/x-icon" href="images/title.ico" />
  <style>
    body { font-family:"Comic Sans MS"; background:#f0f4ff; text-align:center; }
    h1 { color:#2b7cff; }
    table { width:90%; margin:auto; border-collapse:collapse; margin-top:20px; background:white; }
    th, td { border:1px solid #ccc; padding:8px; text-align:center; }
    th { background:#2b7cff; color:white; }
    input[type="text"], input[type="password"] { width:90%; padding:4px; border-radius:4px; border:1px solid #ccc; }
    button { background:#2b7cff; color:white; border:none; padding:5px 10px; border-radius:6px; cursor:pointer; transition:0.2s; }
    button:hover { background:#1a5fd1; }
    #logoutBtn { background:red; margin-top:10px; }
    img.avatar { width:40px; height:40px; border-radius:50%; object-fit:cover; }
  </style>
</head>
<body>
<h1>Admin Panel</h1>

<div id="loginDiv">
  <label>Login:</label>
  <input type="text" id="adminLogin"><br><br>
  <label>Password:</label>
  <input type="password" id="adminPass"><br><br>
  <button id="loginBtn">Login</button>
</div>

<div id="adminDiv" style="display:none;">
  <table id="usersTable">
    <tr>
      <th>ID</th><th>Avatar</th><th>Username</th><th>Name</th><th>Password</th><th>Actions</th>
    </tr>
  </table>
  <button id="logoutBtn">Logout</button>
</div>

<script>
(()=>{

// Простое шифрование для скрытия логина/пароля
function encrypt(str){ return btoa(str); }
function decrypt(str){ return atob(str); }

const ADMIN_LOGIN=encrypt('as1owner');
const ADMIN_PASS=encrypt('where1am');

let isAdmin=false;

const loginDiv=document.getElementById('loginDiv');
const adminDiv=document.getElementById('adminDiv');
const loginBtn=document.getElementById('loginBtn');
const logoutBtn=document.getElementById('logoutBtn');
const usersTable=document.getElementById('usersTable');

loginBtn.addEventListener('click', ()=>{
  const login=document.getElementById('adminLogin').value.trim();
  const pass=document.getElementById('adminPass').value.trim();
  if(encrypt(login)===ADMIN_LOGIN && encrypt(pass)===ADMIN_PASS){
    isAdmin=true;
    loginDiv.style.display='none';
    adminDiv.style.display='block';
    renderUsers();
  } else alert('Invalid credentials!');
});

logoutBtn.addEventListener('click', ()=>{
  isAdmin=false;
  loginDiv.style.display='block';
  adminDiv.style.display='none';
});

function renderUsers(){
  if(!isAdmin) return;
  let users=JSON.parse(localStorage.getItem('users_db')||'[]');
  usersTable.innerHTML=`
    <tr>
      <th>ID</th><th>Avatar</th><th>Username</th><th>Name</th><th>Password</th><th>Actions</th>
    </tr>`;
  users.forEach(u=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td>${u.id}</td>
      <td><img class="avatar" src="${u.avatar}"><input type="file" data-id="${u.id}" class="avatarInput" accept="image/*"></td>
      <td><input type="text" value="${u.username}" data-id="${u.id}" class="usernameInput"></td>
      <td><input type="text" value="${u.name}" data-id="${u.id}" class="nameInput"></td>
      <td><input type="text" value="${u.password}" data-id="${u.id}" class="passInput"></td>
      <td><button class="saveBtn" data-id="${u.id}">Save</button> <button class="delBtn" data-id="${u.id}">Delete</button></td>`;
    usersTable.appendChild(tr);
  });

  document.querySelectorAll('.saveBtn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(!isAdmin) return;
      const id=parseInt(btn.dataset.id);
      let users=JSON.parse(localStorage.getItem('users_db')||'[]');
      const index=users.findIndex(u=>u.id===id);
      if(index!==-1){
        users[index].username=document.querySelector(`.usernameInput[data-id="${id}"]`).value.trim();
        users[index].name=document.querySelector(`.nameInput[data-id="${id}"]`).value.trim();
        users[index].password=document.querySelector(`.passInput[data-id="${id}"]`).value.trim();
        localStorage.setItem('users_db',JSON.stringify(users));
        renderUsers();
      }
    });
  });

  document.querySelectorAll('.delBtn').forEach(btn=>{
    btn.addEventListener('click', ()=>{
      if(!isAdmin) return;
      if(!confirm('Delete this user?')) return;
      const id=parseInt(btn.dataset.id);
      let users=JSON.parse(localStorage.getItem('users_db')||'[]');
      users=users.filter(u=>u.id!==id);
      localStorage.setItem('users_db',JSON.stringify(users));
      renderUsers();
    });
  });

  document.querySelectorAll('.avatarInput').forEach(inp=>{
    inp.addEventListener('change', e=>{
      if(!isAdmin) return;
      const id=parseInt(inp.dataset.id);
      const file=inp.files[0];
      if(file){
        const reader=new FileReader();
        reader.onload=function(evt){
          let users=JSON.parse(localStorage.getItem('users_db')||'[]');
          const index=users.findIndex(u=>u.id===id);
          if(index!==-1){
            users[index].avatar=evt.target.result;
            localStorage.setItem('users_db',JSON.stringify(users));
            renderUsers();
          }
        }
        reader.readAsDataURL(file);
      }
    });
  });
})();
</script>
</body>
</html>
