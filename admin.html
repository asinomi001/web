<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Admin Panel - Asinomi</title>
<link rel="icon" type="images/x-icon" href="images/title.ico" />
<style>
body {
  font-family: "Comic Sans MS";
  background-color: #111;
  color: white;
  text-align: center;
  margin: 0;
  padding: 20px;
}
.container {
  background: #222;
  border-radius: 15px;
  padding: 20px;
  width: 80%;
  margin: auto;
  box-shadow: 0 0 20px rgba(255,255,255,0.2);
}
input, button, select {
  font-family: inherit;
  margin: 5px;
  padding: 8px;
  border-radius: 8px;
  border: none;
  outline: none;
}
input {
  width: 200px;
}
button {
  background: #2b7cff;
  color: white;
  cursor: pointer;
}
button:hover {
  background: #1a55b5;
}
.user-card {
  background: #333;
  border-radius: 10px;
  padding: 10px;
  margin: 10px;
}
</style>
</head>
<body>

<h1>Admin Panel</h1>
<p>Manage all user accounts</p>

<div id="loginSection">
  <h3>Admin Login</h3>
  <input type="text" id="adminLogin" placeholder="Login">
  <input type="password" id="adminPassword" placeholder="Password">
  <button onclick="adminLogin()">Enter</button>
</div>

<div id="adminPanel" style="display:none;">
  <h2>Users</h2>
  <div id="usersList"></div>
</div>

<script>
const ADMIN_LOGIN = "as1owner";
const ADMIN_PASSWORD = "where1am";

function adminLogin() {
  const login = document.getElementById("adminLogin").value.trim();
  const pass = document.getElementById("adminPassword").value.trim();
  if(login === ADMIN_LOGIN && pass === ADMIN_PASSWORD){
    document.getElementById("loginSection").style.display = "none";
    document.getElementById("adminPanel").style.display = "block";
    loadUsers();
  } else {
    alert("Incorrect admin credentials!");
  }
}

function loadUsers(){
  const users = JSON.parse(localStorage.getItem("users") || "[]");
  const list = document.getElementById("usersList");
  list.innerHTML = "";

  if(users.length === 0){
    list.innerHTML = "<p>No users registered.</p>";
    return;
  }

  users.forEach((user, index) => {
    const div = document.createElement("div");
    div.className = "user-card";
    div.innerHTML = `
      <p><b>Username:</b> ${user.username}</p>
      <p><b>Name:</b> ${user.name || "-"}</p>
      <p><b>Email:</b> ${user.email || "-"}</p>
      <p><b>ID:</b> <input type="number" id="id_${index}" value="${user.id}" /></p>
      <p><b>Password:</b> <input type="text" id="pass_${index}" value="${user.password}" /></p>
      <button onclick="saveUser(${index})">ðŸ’¾ Save</button>
      <button onclick="deleteUser(${index})" style="background:red;">ðŸ—‘ Delete</button>
    `;
    list.appendChild(div);
  });
}

function saveUser(index){
  const users = JSON.parse(localStorage.getItem("users") || "[]");
  const idInput = document.getElementById(`id_${index}`).value.trim();
  const passInput = document.getElementById(`pass_${index}`).value.trim();

  if(!idInput || isNaN(idInput)){
    alert("Invalid ID!");
    return;
  }

  // ÐžÐ±Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ Ð´Ð°Ð½Ð½Ñ‹Ñ… Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
  users[index].id = parseInt(idInput);
  users[index].password = passInput;

  // ÐžÐ±Ð½Ð¾Ð²Ð»ÑÐµÐ¼ Ð²ÑÐµ ÑÐ²ÑÐ·Ð¸ (Ð´Ñ€ÑƒÐ·ÑŒÑ, Ñ‡Ð°Ñ‚Ñ‹ Ð¸ Ñ‚.Ð´.)
  const chats = JSON.parse(localStorage.getItem("chats") || "{}");
  for(const chatId in chats){
    chats[chatId].messages = chats[chatId].messages.map(msg => {
      if(msg.senderId === users[index].oldId) msg.senderId = users[index].id;
      return msg;
    });
  }
  localStorage.setItem("chats", JSON.stringify(chats));

  localStorage.setItem("users", JSON.stringify(users));
  alert("User updated!");
}

function deleteUser(index){
  const users = JSON.parse(localStorage.getItem("users") || "[]");
  if(confirm(`Delete user ${users[index].username}?`)){
    users.splice(index, 1);
    localStorage.setItem("users", JSON.stringify(users));
    loadUsers();
  }
}
</script>
</body>
</html>
