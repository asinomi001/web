<!DOCTYPE html>
<html>
<head>
  <title>Sign Up</title>
  <link rel="icon" type="images/x-icon" href="images/title.ico" />
  <style>
    body { font-family:"Comic Sans MS"; background:#f0f4ff; text-align:center; }
    h1 { color:#2b7cff; }
    form { margin: 20px auto; max-width: 400px; text-align:left; background:white; padding:20px; border-radius:8px; }
    label { display:block; margin:10px 0 5px; }
    input[type="text"], input[type="password"], input[type="file"] { width:100%; padding:8px; border-radius:6px; border:1px solid #ccc; }
    .avatars { display:flex; justify-content:center; flex-wrap:wrap; margin:10px 0; }
    .avatars img { width:50px; height:50px; margin:5px; border-radius:50%; border:2px solid transparent; cursor:pointer; object-fit:cover; transition:0.2s; }
    .avatars img.selected { border-color:#2b7cff; transform: scale(1.2); }
    button { background:#2b7cff; color:white; border:none; padding:10px 20px; border-radius:6px; cursor:pointer; margin-top:10px; transition:0.2s; }
    button:hover { background:#1a5fd1; }
    #preview { display:block; margin:10px auto; width:80px; height:80px; border-radius:50%; object-fit:cover; border:2px solid #2b7cff; }
  </style>
</head>
<body>

<h1>SIGN UP (Create your account)</h1>

<form id="signupForm">
  <label>Username (login)</label>
  <input type="text" id="login" required>

  <label>Name</label>
  <input type="text" id="name" required>

  <label>Password</label>
  <input type="password" id="password" required>

  <label>Choose Avatar</label>
  <div class="avatars" id="avatarOptions">
    <img src="images/avatar1.png" data-src="images/avatar1.png">
    <img src="images/avatar2.png" data-src="images/avatar2.png">
    <img src="images/avatar3.png" data-src="images/avatar3.png">
    <img src="images/avatar4.png" data-src="images/avatar4.png">
  </div>

  <label>Or Upload Your Avatar</label>
  <input type="file" id="customAvatar" accept="image/*">

  <img id="preview" src="images/avatar1.png">

  <button type="submit">Register</button>
</form>

<script>
// Проверка, если пользователь уже залогинен
const loggedUser = JSON.parse(localStorage.getItem('logged_user'));
if(loggedUser){ window.location.href='account.html'; }

const avatarOptions = document.querySelectorAll('#avatarOptions img');
let selectedAvatar = avatarOptions[0].dataset.src;
const preview = document.getElementById('preview');

avatarOptions.forEach(img=>{
  img.addEventListener('click', ()=>{
    avatarOptions.forEach(i=>i.classList.remove('selected'));
    img.classList.add('selected');
    selectedAvatar = img.dataset.src;
    preview.src = selectedAvatar;
  });
});

document.getElementById('customAvatar').addEventListener('change', e=>{
  const file = e.target.files[0];
  if(file){
    const reader = new FileReader();
    reader.onload = function(evt){
      preview.src = evt.target.result;
      selectedAvatar = evt.target.result;
      avatarOptions.forEach(i=>i.classList.remove('selected'));
    }
    reader.readAsDataURL(file);
  }
});

document.getElementById('signupForm').addEventListener('submit', e=>{
  e.preventDefault();
  const login = document.getElementById('login').value.trim();
  const name = document.getElementById('name').value.trim();
  const password = document.getElementById('password').value.trim();

  if(!login || !name || !password) return alert('Fill all fields!');

  // Получаем базу пользователей
  let users = JSON.parse(localStorage.getItem('users_db')) || [];
  if(users.find(u=>u.login===login)) return alert('Username already exists!');

  // Создаём нового пользователя
  const id = users.length+1;
  const newUser = {id, login, username:login, name, password, avatar:selectedAvatar};
  users.push(newUser);
  localStorage.setItem('users_db', JSON.stringify(users));
  localStorage.setItem('logged_user', JSON.stringify(newUser));

  alert('Registered! You are now logged in.');
  window.location.href='index.html';
});
</script>

</body>
</html>
